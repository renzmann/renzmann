#!/usr/bin/env bash
yn_prompt() {
	while true; do
			read -p "$* [y/n]: " yn
			case $yn in
					[Yy]*) return 0  ;;
					[Nn]*) echo "Aborted" ; return  1 ;;
			esac
	done
}

_install_nvim() {
	[[ -z $1 ]] && local version='0.7.0' || local version=$1
	local download_url="https://github.com/neovim/neovim/releases/download/v${version}"

	case $OSTYPE in
		'darwin'*)
			curl -sSLO ${download_url}/nvim-macos.tar.gz \
				&& tar xzvf nvim-macos.tar.gz \
				&& mv ./nvim-macos.tar.gz $HOME/.local/bin
			;;
		*)
			curl -LO ${download_url}/nvim.appimage \
				&& chmod u+x nvim.appimage \
				&& mv nvim.appimage $HOME/.local/bin/nvim
			;;
	esac

	cd $HOME
	so .nvim.venv || new-venv .nvim.venv
	python3 -m pip install black flake8 jedi jedi-language-server neovim mypy
	deactivate
	cd -

	yn_prompt 'Install language servers?' && install-language-servers
}

_install_nvim $@
